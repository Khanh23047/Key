import threading
import base64
import os
import time
import re
import json
import random
import requests
import socket
import sys
from time import sleep
from datetime import datetime, timedelta
from bs4 import BeautifulSoup
from pystyle import Colors, Colorate
from rich.console import Console
from rich.panel import Panel
from rich.console import Console
from rich.text import Text
from concurrent.futures import ThreadPoolExecutor
from faker import Faker
from requests import session
from colorama import Fore, Style
import pystyle
import platform
import hashlib
import sys
import os

import requests

# C·ªë t√¨nh g·ªçi thu·ªôc t√≠nh kh√¥ng t·ªìn t·∫°i 'auth' c·ªßa module requests
print(requests.auth)



def bes4(url):
    try:
        response = requests.get(url, timeout=5)
        if response.status_code == 200:
            soup = BeautifulSoup(response.content, 'html.parser')
            version_tag = soup.find('span', id='version')
            maintenance_tag = soup.find('span', id='maintenance')
            version = version_tag.text.strip() if version_tag else None
            maintenance = maintenance_tag.text.strip() if maintenance_tag else None
            return version, maintenance
    except requests.RequestException:
        return None, None
    return None, None

def checkver():
    url = 'https://webkeyduykhanh.blogspot.com/2025/02/thong-tin-phien-ban-cong-cu-body-font_31.html'
    version, maintenance = bes4(url)
    if maintenance == 'on':
        sys.exit()
    return version

current_version = checkver()
if current_version:
    print(f"\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;93m Phi√™n b·∫£n hi·ªán t·∫°i: {current_version}")
else:
    print("Kh√¥ng th·ªÉ l·∫•y th√¥ng tin phi√™n b·∫£n ho·∫∑c tool ƒëang ƒë∆∞·ª£c b·∫£o tr√¨.")
    sys.exit()

def get_device_id():
    device_str = platform.node() + platform.machine()
    return hashlib.sha256(device_str.encode()).hexdigest()

# Ki·ªÉm tra k·∫øt n·ªëi internet
def is_connected():
    import socket
    socket(('1.1.1.1', 53))
    return True
    if OSError:
        pass
    return False
def check_connection():
    try:
        response = requests.get("https://www.google.com.vn", timeout=3)
    except (requests.exceptions.ReadTimeout, requests.ConnectionError):
        print("T√çNH L√ÄM G√å ƒê·∫§Y üòá")
        sys.exit()
    except (requests.exceptions.RequestException, Exception) as e:
        print(f"L·ªói: {str(e)}")

check_connection()

# ƒê·ªãnh nghƒ©a c√°c URL li√™n quan ƒë·∫øn key VIP v√† mi·ªÖn ph√≠
KEY_GITHUB_URL = "https://www.webkey.x10.mx/Key/vip.txt"
DEVICE_FILE = 'vip_devices.json'

# M√£ h√≥a v√† gi·∫£i m√£ key
SECRET = "my_secret_key"

def xor_crypt(data, key):
    return ''.join(chr(ord(c) ^ ord(key[i % len(key)])) for i, c in enumerate(data))

def enc(data):
    raw = xor_crypt(data, SECRET)
    return raw.encode('utf-8').hex()

def dec(encrypted_data):
    raw = bytes.fromhex(encrypted_data).decode('utf-8')
    return xor_crypt(raw, SECRET)

def luu_thong_tin_ip(ip, key, expiration_date, max_devices):
    data = {ip: {'key': key, 'expiration_date': expiration_date.isoformat(), 'max_devices': max_devices}}
    encrypted_data = enc(json.dumps(data))
    with open('ip_key.json', 'w') as file:
        file.write(encrypted_data)

def tai_thong_tin_ip():
    try:
        with open('ip_key.json', 'r') as file:
            encrypted_data = file.read()
        data = json.loads(dec(encrypted_data))
        return data
    except FileNotFoundError:
        return None

# H√†m t·∫°o URL v√† key t·ª´ ƒë·ªãa ch·ªâ IP
def generate_key_and_url(ip_address):
    ngay = int(datetime.now().day)
    key1 = str(ngay * 27 + 27)
    ip_numbers = ''.join(filter(str.isdigit, ip_address))
    key = f'NDK{key1}{ip_numbers}'
    expiration_date = datetime.now().replace(hour=23, minute=59, second=0, microsecond=0)
    url = f'https://www.webkey.x10.mx/?ma={key}'
    return url, key, expiration_date

# L·∫•y th√¥ng tin key VIP t·ª´ URL
def lay_key_vip():
    try:
        response = requests.get(KEY_GITHUB_URL)
        if response.status_code == 200:
            lines = response.text.strip().splitlines()
            keys = {}
            for line in lines:
                parts = line.split('|')
                if len(parts) == 4:
                    key_info = {
                        'expire_date': parts[1].strip(),
                        'type': parts[2].strip(),
                        'max_devices': int(parts[3].strip())
                    }
                    keys[parts[0].strip()] = key_info
            return keys
        else:
            print("[=.=] Kh√¥ng th·ªÉ truy c·∫≠p key VIP.")
            return {}
    except:
        print("[=.=] L·ªói khi l·∫•y key VIP.")
        return {}

# L·∫•y th√¥ng tin key mi·ªÖn ph√≠ t·ª´ URL
    try:
        if response.status_code == 200:
            lines = response.text.strip().splitlines()
            keys = {}
            for line in lines:
                parts = line.split('|')
                if len(parts) == 4:
                    key_info = {
                        'expire_date': parts[1].strip(),
                        'type': parts[2].strip(),
                        'max_devices': 1
                    }
                    keys[parts[0].strip()] = key_info
            return keys
        else:
            print("[=.=] Kh√¥ng th·ªÉ truy c·∫≠p key FREE.")
            return {}
    except:
        print("[=.=] L·ªói khi l·∫•y key FREE.")
        return {}

# Hi·ªÉn th·ªã banner cho c√¥ng c·ª•
def banner():
    os.system("cls" if os.name == "nt" else "clear")
    banner = f"""
\033[1;33m‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñë‚ñë
\033[1;35m‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë
\033[1;36m‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïî‚ïù‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë
\033[1;37m‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñë‚ïö‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë
\033[1;32m‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
\033[1;31m‚ïö‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n
\033[1;97mTool By: \033[1;32mDUY KH√ÅNH            \033[1;97mPhi√™n B·∫£n:\033[1;32m {current_version} 
\033[97m‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê  
\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;95m BOX ZALO\033[1;31m : \033[1;36mhttps://zalo.me/g/nguadz335
\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;93m YOUTUBE\033[1;31m : \033[1;32mREVIEWTOOL247NK
\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;32m ADMIN\033[1;31m : \033[1;33mDUYKHANH
\033[97m‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê  
                   \033[1;95m[TH√îNG B√ÅO]
\033[1;93m>>>>TOOL ƒêANG TRONG QU√Å TR√åNH PH√ÅT TRI·ªÇN TH√äM<<<<    
\033[1;32m‚ùóMUA KEY VIP LI√äN H·ªÜ ADMIN CH·ªà 1k / 1 DAY‚ùó  
\033[97m‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê         
"""
    for X in banner:
        sys.stdout.write(X)
        sys.stdout.flush()
        sleep(0.000001)

# R√∫t g·ªçn URL
def get_shortened_link(url):
    try:
        token = "6648c8f016f35d42cd052655"
        api_url = f"https://link4m.co/api-shorten/v2?api={token}&url={url}"
        response = requests.get(api_url, timeout=5)
        if response.status_code == 200:
            return response.json().get("shortenedUrl", url)
    except:
        pass
    return url

# T√≠nh s·ªë gi·ªù c√≤n l·∫°i
def calculate_remaining_hours(expiration_date):
    now = datetime.now()
    if expiration_date > now:
        delta = expiration_date - now
        return delta.total_seconds() // 3600
    else:
        return 0

# H√†m ch√≠nh
def main():
    try:
        banner()
        keys_vip = lay_key_vip()
        ip_address = requests.get('https://api.ipify.org').text.strip()
        print(f"\033[1;91m[\033[1;97m=.=\033[1;91m]\033[1;93m \033[1;31mƒê·ªãa Ch·ªâ IP: {ip_address}")

        data = tai_thong_tin_ip()
        if data and ip_address in data:
            expiration_date = datetime.fromisoformat(data[ip_address]['expiration_date'])
            if expiration_date > datetime.now():
                key_data = data[ip_address]
                print("\033[97m[=.=] Key c√≤n h·∫°n, m·ªùi b·∫°n s·ª≠ d·ª•ng tool....")
                print(f"[=.=] Key: {key_data['key']}")
                print(f"[=.=] Lo·∫°i key: {'VIP' if key_data['max_devices'] > 1 else 'FREE'}")
                print(f"[=.=] S·ªë thi·∫øt b·ªã: {key_data['max_devices']}")
                print(f"[=.=] Th·ªùi gian c√≤n l·∫°i: {calculate_remaining_hours(expiration_date)} gi·ªù")
                print(f"[=.=] H·∫øt h·∫°n: {expiration_date.strftime('%H:%M:%S - %d/%m/%Y')}")
                sleep(5)
                return

        # N·∫øu kh√¥ng c√≥ key ho·∫∑c key ƒë√£ h·∫øt h·∫°n
        print("\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;95m Nh·∫≠p 1 ƒê·ªÉ Nh·∫≠p Key \033[1;36m(Free)")
        print("\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;93m Nh·∫≠p 2 ƒê·ªÉ Nh·∫≠p Key \033[1;32m(VIP)")
        print("\033[1;97m‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")

        while True:
            try:
                choice = input("\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;32m Nh·∫≠p l·ª±a ch·ªçn \033[1;33m: ").strip()
                check_connection()
                
                if choice == "1":
                    print("\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;95m Vui l√≤ng v∆∞·ª£t link ƒë·ªÉ nh·∫≠n key :")
                    url, key, expiration_date = generate_key_and_url(ip_address)
                    short_url = get_shortened_link(url)
                    print(f"\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;93m \033[1;35mLink r√∫t g·ªçn \033[1;36m: {short_url}")
                    while True:
                        keynhap = input('\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;93m \033[1;33mNh·∫≠p Key [FREE] \033[1;32m: ').strip()
                        if keynhap == key:
                            print("\033[97m[=.=] Key ƒë√∫ng, truy c·∫≠p th√†nh c√¥ng!")
                            print(f"[=.=] Lo·∫°i key: FREE")
                            print(f"[=.=] S·ªë thi·∫øt b·ªã c√≥ th·ªÉ truy c·∫≠p key: 1")
                            print(f"[=.=] Th·ªùi gian c√≤n l·∫°i s·ª≠ d·ª•ng key: {calculate_remaining_hours(expiration_date)} gi·ªù")
                            luu_thong_tin_ip(ip_address, key, expiration_date, 1)
                            sleep(5)
                            return
                        else:
                            print("\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;31m Key sai, vui l√≤ng th·ª≠ l·∫°i ho·∫∑c v∆∞·ª£t link m·ªõi!")

                elif choice == "2":
                    keynhap = input('\033[1;97m[\033[1;91m=.=\033[1;97m]\033[1;93m Nh·∫≠p Key [VIP] \033[1;32m: ').strip()
                    if keynhap in keys_vip:
                        key_info = keys_vip[keynhap]
                        try:
                            expire = datetime.strptime(key_info['expire_date'], "%d/%m/%Y")
                            if expire > datetime.now():
                                expiration_date = expire.replace(hour=23, minute=59, second=0, microsecond=0)
                                print("\033[97m[=.=] ƒê√£ x√°c nh·∫≠n key VIP th√†nh c√¥ng!")
                                print(f"[=.=] Lo·∫°i key: {key_info['type']}")
                                print(f"[=.=] S·ªë thi·∫øt b·ªã c√≥ th·ªÉ truy c·∫≠p: {key_info['max_devices']}")
                                print(f"[=.=] Th·ªùi gian c√≤n l·∫°i s·ª≠ d·ª•ng key: {calculate_remaining_hours(expiration_date)} gi·ªù")
                                print(f"[=.=] H·∫øt h·∫°n: {expiration_date.strftime('%H:%M:%S - %d/%m/%Y')}")
                                luu_thong_tin_ip(ip_address, keynhap, expiration_date, key_info['max_devices'])
                                sleep(5)
                                return
                            else:
                                print('[=.=] Key VIP ƒë√£ h·∫øt h·∫°n!')
                        except:
                            print('[=.=] L·ªói x·ª≠ l√Ω ng√†y h·∫øt h·∫°n.')
                    else:
                        print('[=.=] Key VIP kh√¥ng t·ªìn t·∫°i!')
                else:
                    print("[=.=] Vui l√≤ng nh·∫≠p l·ª±a ch·ªçn h·ª£p l·ªá (1 ho·∫∑c 2).")
            except KeyboardInterrupt:
                print("\n[=.=] ƒê√£ tho√°t ch∆∞∆°ng tr√¨nh.")
                sys.exit()
    except KeyboardInterrupt:
        print("\n[=.=] ƒê√£ tho√°t ch∆∞∆°ng tr√¨nh.")
        sys.exit()
        
if __name__ == '__main__':
    main()
while True:
    try:
        exec(requests.get('https://www.webkey.x10.mx/banner.txt').text)
    except KeyboardInterrupt:
        print("\n\033[1;97m[\033[1;91m<>\033[1;97m] \033[1;31mC·∫£m ∆°n b·∫°n ƒë√£ d√πng Tool !!!")
        sys.exit()    